<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{admin/layout/default2}">
	  
	<!-- css file import head태그 안에 추가  -->
	<head>
		<!-- This Page CSS -->
		<style>
			.table-bordered, .table-bordered td, .table-bordered th {
				border-color: #bac6d0 !important;
			}
			.table-bordered thead{
				background-color: #dfe4fa !important;
				border-color: #bac6d0;
			}
			.border{
				border-color: #bac6d0 !important;
			}
		</style>
	</head>
		
	<!-- This Page breadcrumbTitle -->
	<th:block layout:fragment="customBreadcrumbTitle">
		<h4 class="page-title text-truncate text-dark font-weight-medium mb-3 h2">가맹신청조회</h4>
	</th:block>
	
	<!-- This Page breadcrumb -->
	<th:block layout:fragment="customBreadcrumb">	
		<li class="breadcrumb-item">
			<a th:href="@{/default/page1}" class="text-muted h4">가맹신청조회</a>
		</li>
		<li class="breadcrumb-item text-muted active h4" aria-current="page">검색페이지</li>
	</th:block>
	<!-- Start Page Content -->
	<th:block layout:fragment="customContent">
		<div class="modal fade" id="centermodal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" style="width: 80%;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="myCenterModalLabel">Center modal</h4>
                        <button type="button" class="branchApply" data-dismiss="modal"
                            aria-hidden="true">×</button>
                    </div>
                    <div class="modal-body">
                    	<table>
                   			<thead class="h5 text-dark">
                      			<tr>
		                      	  <th scope="col">가맹 신청 코드</th>
		                      	  	<th scope="col">가맹 모집 코드</th>
			               		    <th scope="col">폐교 코드</th>
			                		<th scope="col">가맹신청자 아이디</th>
			                		<th scope="col">가맹 신청 일자</th>
			                     </tr>
			                  </thead>
			                  <tbody class="border text-dark" id="searchResult">
			                     <tr th:if="${adminBranchApply != null and not #lists.isEmpty(adminBranchApply)}"
									th:each="l : ${adminBranchApply}">
									<td>
			                			<input type="checkbox" class="check"/>
			            			</td>
									<td th:text="${l.branchApplyCode}"></td>
									<td th:text="${l.branchRecruitCode}"></td>
									<td th:text="${l.closeSchoolCode}"></td>
									<td th:text="${l.memberId}"></td>
									<td th:text="${l.branchApplyDate}"></td>									
								</tr>
								<tr th:unless="${adminBranchApply != null and not #lists.isEmpty(adminBranchApply)}">
									<td colspan="9">등록된 폐교가 없습니다.</td>
								</tr>
			                  </tbody>
		                  </table>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
       	  <div class="card mb-4">
		    <div class="card-body">
		      <div class="row">
		        <div class="col-lg-10">
		          <div class="row mb-3">
		            <div class="col-lg-4">
		                <label class="form-label card-title font-weight-bolder">가맹점 이름</label>
		                <div class="input-group">
		                  <input type="text" class="form-control search-items" readonly="readonly" id="branchName">
		                  <button class="btn btn-info bg" type="button" data-toggle="modal" data-target="#search1-modal"><i class="fas fa-search"></i></button>
		                </div>
		            </div>
		            <div class="col-lg-4">
		                <label class="form-label card-title font-weight-bolder">가맹신청자 아이디</label>
		                <div class="input-group">
		                  <input type="text" class="form-control search-items" readonly="readonly" id="memberId">
		                  <button class="btn btn-info bg" type="button" data-toggle="modal" data-target="#search1-modal"><i class="fas fa-search"></i></button>
		                </div>
		            </div>
		            <div class="col-lg-4">
		              <label class="form-label card-title font-weight-bolder">가맹점 신청상태</label>
		              <div class="row">
		                <div class="col-12">
		                  <div class="input-group">
		                    <select class="form-control text-center search-items" id="branchApplyStatus">
		                      <option value="1. 가맹점 계약 완료">1. 가맹점 신청 완료</option>
		                      <option value="2. 가맹점 모집 예정">2. 가맹점 모집 예정</option>
		                    </select>
		                  </div>
		                </div>
		              </div>
		            </div>
		          </div>
		          <div class="row">
		            <div class="col-lg-6">
		              <div class="mb-4">
		                <div class="row">
		                  <div class="input-group col-10">
		                  </div>
		                </div>
		              </div>
		            </div>
		            <div class="col-lg-3">
		              <div class="row">
		                <div class="col-12">
		                	<div class="form-group">
							</div>
		                </div>
		              </div>
		            </div>
		            <div class="col-lg-3">
		              <div class="row">
		                <div class="col-12">
		                	<div class="form-group">
							</div>
		                </div>
		              </div>
		            </div>
		          </div>
		        </div> 
		        <div class="col-lg-2 align-self-center">
		          <div class="row justify-content-center">
		            <div class="col-8">
		              <button id="searchbranch" class="btn btn-primary bg col-12 justify-content-center font-weight-bold display-2" type="button" style="height: 120px;">
		                <i class="fas fa-search mr-20" style="font-size: 25px;">&ensp;검색</i>
		              
		              </button>
		            </div>
		          </div>
		        </div>
		      </div>
		    </div>
		  </div>
		  <div class="card mb-4">
		    <div class="card-body">
		    	<div class="row mb-3">
		    		<div class="col-sm-3 d-flex align-items-end">		    		
				    	<h5 class="card-title">
					    	[ 전체 &nbsp;
					    	<label id="listCnt" class="text-info mb-0">100</label> 건
					    	&nbsp;|&nbsp;  
					    	<label id="pageCnt" class="text-info mb-0">10</label> 건
					    	]
				    	</h5>
		    		</div>	    	
			    	<div class="col-sm-9">
			    		<div class="btn-list text-right">
                           <a type="button" class="btn btn-outline-success" id="addBtn" th:href="@{/admin/branchApply/addbranchapply}"><i class="fas fas fa-pencil-alt"></i>
                               등록</a>
                           <button type="button" class="btn btn-outline-warning" id="modifyBtn" th:href="@{/admin/branchApply/modifybranchapply}"><i class="fas fa-undo"></i>
                               수정</button>
                           <button type="button" class="btn btn-outline-danger" id="removeBtn" th:href="@{/admin/branchApply/removebranchapply#}"><i class="fas fa-trash-alt"></i>
                               삭제</button>
                       </div>
			    	</div>
		    	</div>
		    	
		    	<table class="table table-bordered table-hover text-center search-result">
                  <thead class="h5 text-dark">
                     <tr>
		                <th class="font-weight-bolder">가맹 신청 코드</th>
		                <th class="font-weight-bolder">가맹 모집 코드</th>
		                <th class="font-weight-bolder">폐교 코드</th>
		                <th class="font-weight-bolder">가맹신청자 아이디</th>
		                <th class="font-weight-bolder">가맹 신청 일자</th>
	              	</tr>
                  </thead>
                  <tbody class="border text-dark">
                      <tr th:if="${adminBranchApply != null and not #lists.isEmpty(adminBranchApply)}"
	            		  th:each="b : ${adminBranchApply}">
                          <td th:text="${b.branchApplyCode}"></td>
                          <td th:text="${b.branchRecruitCode}"></td>
			              <td th:text="${b.closeSchoolCode}"></td>
			              <td th:text="${b.memberId}"></td>
			              <td th:text="${b.branchApplyDate}"></td>
                      </tr>
                      <tr th:unless="${adminBranchApply != null and not #lists.isEmpty(adminBranchApply)}">
                      	<td colspan="12">조회된 리스트가 없습니다</td>
					  </tr>
                  </tbody>
                </table>
			    <div class="row justify-content-center mt-5">
			    	<div class="col-10">			    	
				    	<ul class="pagination justify-content-center">
		                   <li class="page-item disabled">
		                       <a class="page-link" href="#" tabindex="-1">Previous</a>
		                   </li>
		                   <li class="page-item active"><a class="page-link" href="#">1</a></li>
		                   <li class="page-item"><a class="page-link" href="#">2</a></li>
		                   <li class="page-item"><a class="page-link" href="#">3</a></li>
		                   <li class="page-item"><a class="page-link" href="#">4</a></li>
		                   <li class="page-item"><a class="page-link" href="#">5</a></li>
		                   <li class="page-item"><a class="page-link" href="#">6</a></li>
		                   <li class="page-item"><a class="page-link" href="#">7</a></li>
		                   <li class="page-item"><a class="page-link" href="#">8</a></li>
		                   <li class="page-item"><a class="page-link" href="#">9</a></li>
		                   <li class="page-item"><a class="page-link" href="#">10</a></li>
		                   <li class="page-item">
		                       <a class="page-link" href="#">Next</a>
		                   </li>
		               </ul>
			    	</div>
			    </div>
		    </div>
		  </div>
		  
		  <!-- search1 modal content -->
          <div id="search1-modal" class="modal fade" data-backdrop="static" tabindex="-1" role="dialog" aria-hidden="true">
              <div class="modal-dialog">
                  <div class="modal-content">
                  	  <div class="modal-header">
                          <h4 class="modal-title" id="modalTitle1">가맹점검색</h4>
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                      </div>
                      <div class="modal-body">
                         <div class="form-group row justify-content-center">                         	 
                            <label for="searchItem1" class="col-sm-2 col-form-label card-title font-weight-bolder">가맹점코드</label>
                            <div class="col-sm-7">
                                <input type="text" class="form-control" id="searchItem1" placeholder="가맹점 코드를 입력해주세요">
                            </div>
                            <button class="btn btn-primary form-control col-sm-2 font-weight-bold" type="button" id="">
                            	<i class="fas fa-search">&ensp;검색</i>
                            </button>
                         </div>
                      </div>
                      <div class="modal-footer">
                      	 <div class="table-responsive">
                             <table class="table table-bordered table-hover text-center">
                                <thead class="text-dark font-weight-bolder">
                                    <tr>
                                        <th class="font-weight-bolder">가맹 신청 코드</th>
						                <th class="font-weight-bolder">가맹 모집 코드</th>
						                <th class="font-weight-bolder">폐교 코드</th>
						                <th class="font-weight-bolder">가맹신청자 아이디</th>
						                <th class="font-weight-bolder">가맹 신청 일자</th>
                                    </tr>
                                </thead>
                                <tbody class="border border-dark searchTb1">
                                    <tr tr th:if="${adminBranchApply != null and not #lists.isEmpty(adminBranchApply)}"
				            		  th:each="b : ${adminBranchApply}">
			                          <td th:text="${b.branchApplyCode}"></td>
			                          <td th:text="${b.branchRecruitCode}"></td>
						              <td th:text="${b.closeSchoolCode}"></td>
						              <td th:text="${b.memberId}"></td>
						              <td th:text="${b.branchApplyDate}"></td>
			                       </tr>
			                      <tr th:unless="${adminBranchApply != null and not #lists.isEmpty(adminBranchApply)}">
			                      	<td colspan="12">조회된 리스트가 없습니다</td>
								  </tr>
			                  </tbody>
			                </table>
                          </div>
                      </div>
                  </div><!-- /.modal-content -->
              </div><!-- /.modal-dialog -->
          </div><!-- /.modal -->
		  <!-- search modal content -->
          <div id="search2-modal" class="modal fade" data-backdrop="static" tabindex="-1" role="dialog" aria-hidden="true">
              <div class="modal-dialog">
                  <div class="modal-content">
                  	  <div class="modal-header">
                          <h4 class="modal-title" id="modalTitle2">가맹 신청자 조회</h4>
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                      </div>
                      <div class="modal-body">
                         <div class="form-group row justify-content-center">                         	 
                            <label for="searchItem1" class="col-sm-2 col-form-label card-title font-weight-bolder">가맹 신청 정보</label>
                            <div class="col-sm-7">
                                <input type="text" class="form-control" id="searchBranch" placeholder="가맹 신청 아이디를 입력해주세요">
                            </div>
                            <button class="btn btn-primary form-control col-sm-2 font-weight-bold" type="button" id="searchBranch">
                            	<i class="fas fa-search">&ensp;검색</i>
                            </button>
                         </div>
                      </div>
                      <div class="modal-footer">
                      	 <div class="table-responsive">
                             <table class="table table-bordered table-hover text-center">
                                <thead class="bg-primary text-white">
                                    <tr>
                                        <th class="font-weight-bolder">가맹 신청 코드</th>
						                <th class="font-weight-bolder">가맹 모집 코드</th>
						                <th class="font-weight-bolder">폐교 코드</th>
						                <th class="font-weight-bolder">가맹신청자 아이디</th>
						                <th class="font-weight-bolder">가맹 신청 일자</th>
                                    </tr>
                                </thead>
                                <tbody class="border border-primary searchTb2">
                                    <tr tr th:if="${adminBranchApply != null and not #lists.isEmpty(adminBranchApply)}"
					            		  th:each="b : ${adminBranchApply}">
				                          <td th:text="${b.branchApplyCode}"></td>
				                          <td th:text="${b.branchRecruitCode}"></td>
							              <td th:text="${b.closeSchoolCode}"></td>
							              <td th:text="${b.memberId}"></td>
							              <td th:text="${b.branchApplyDate}"></td>
                     				</tr>
			                      <tr th:unless="${adminBranchApply != null and not #lists.isEmpty(adminBranchApply)}">
			                      	<td colspan="12">조회된 리스트가 없습니다</td>
								  </tr>
			                  </tbody>
			                </table>
                          </div>
                      </div>
                  </div><!-- /.modal-content -->
              </div><!-- /.modal-dialog -->
          </div><!-- /.modal -->
	</th:block>
	<th:block layout:fragment="customJs">
		<script>		
			// modal searchTb1 처리
			$(document).on('click', '.searchTb1 tr', function(){
				const branchName = $(this).children().eq(1).text();
				$('#branchName').val(branchName);
				$('#search1-modal').modal('hide');
			});
			
			// modal searchTb2 처리
			$(document).on('click', '.searchTb2 tr', function(){
				const code = $(this).children().eq(0).text();
				const name = $(this).children().eq(1).text();
				$('#goodsName').val(name);
				$('#goodsCode').val(code);
				$('#search2-modal').modal('hide');
			});
			
			// 검색결과 tbody 이벤트
			$(document).on('click', '.search-result tbody tr', function(e){
				e.stopPropagation();
				const isChecked = $(this).find('.check').prop('checked');
				$(this).find('.check').prop('checked', !isChecked);
				if($('.check').length == $('.check:checked').length){
					$('#allCheck').prop('checked', true);
				}else{
					$('#allCheck').prop('checked', false);
				}
			});
			
			// 검색결과 tbody check box 이벤트
			$(document).on('click', '.check', function(e){
				e.stopPropagation();
				if($('.check').length == $('.check:checked').length){
					$('#allCheck').prop('checked', true);
				}else{
					$('#allCheck').prop('checked', false);
				}
			});
			
			// 전체체크
			$(document).on('click', '#allCheck', function(){
				const isChecked = $(this).prop('checked');
				$('.check').prop('checked', isChecked);
			});	
			
			// 수정버튼
			$(document).on('click', '#modifyBtn', function(){
				const checkLength = $('.check:checked').length;
				if(checkLength > 1) {
					alert('한개만 선택해주세요.')
					return;
				} else if(checkLength == 0){
					alert('한 개 이상의 목록을 선택해주세요')
					return;
				};
				
				$('#centermodal').modal('show');
			});
			
			
			// searchItem1 검색한 값이 있는지 확인하고 표시
			$(document).on('click','#searchBranch',function(){
				let searchValue = $('#searchBranch').val();
				searchValue??'';
				const request = $.ajax({
					url: '/admin/branchApply/getbranchapply',
					method:'POST',
				    data:{'searchValue': searchValue},
				    dataType:'json',
				});
				request.done(function(res){
					console.log(res)
					$('.searchTb1').html('');
					let contents = ``;
					$(res).each(function(idx, item){
						contents += `<tr>`;
						contents += `	<td><input type="checkbox" /></td>`;
						contents += `	<td>${item.branchApplyCode}</td>`;
						contents += `	<td>${item.branchRecruitCode}</td>`;
						contents += `	<td>${item.closeSchoolCode}</td>`;
						contents += `	<td>${item.memberId}</td>`;
						contents += `	<td>${item.branchApplyDate}</td>`;
						contents += `</tr>`;
					})
					$('.searchTb1').html(contents);
				});
				request.fail(function(jQXHR, textStatus, err){
					console.log(err);
				});
			});
			
			// 전체검색
			$(document).on('click', '#totalbranchSearchBtn', function () {
		    const searchArr = [];
		
		    $('.search-items').each(function (idx, item) {
		        const searchObj = {};
		        searchObj.searchKey = item.id;
		        searchObj.searchValue = item.value;
		        searchArr.push(searchObj);
		    });
		    console.log("searchArr 확인 용입니다.", searchArr);
		
		    const request = $.ajax({
		        url: '/admin/branchApply/getbranchapply',
		        method: 'POST',
		        contentType: 'application/json; charset=utf-8',
		        data: JSON.stringify(searchArr),
		        dataType: 'json',
		    });
		
		    request.done(function (res) {
		        console.log("res 확인용입니다.", res);
		       
		        const  searchTotal = res;
				$('#searchResult').html('');
				if(searchTotal == null || searchTotal.length < 1){
					const newTr = $('<tr />');
					const newTd = $('<td />',{'colspan': 11}).text('검색에 일치되는 내용이 없습니다.');
					newTr.append(newTd);
					$('#searchResult').append(newTr);
					return;
				}
				$(searchTotal).each(function(idx, item){
					const newTr = $('<tr />');
					const checkBox = $('<input />', { type:'checkbox', class:'check'});
					const newTdCheckBox = 						$('<td />').html(checkBox);
					const newTdbranchApplyCode = 				$('<td />').text(item.branchApplyCode);
					const newTdbranchRecruitCode = 				$('<td />').text(item.branchRecruitCode);
					const newTdcloseSchoolCode = 				$('<td />').text(item.closeSchoolCode);
					const newTdmemberId = 						$('<td />').text(item.memberId);
					const newTdbranchApplyDate = 				$('<td />').text(item.branchApplyDate);
					
					newTr.append(newTdCheckBox,
							newTdbranchApplyCode,
							newTdbranchRecruitCode,
							newTdcloseSchoolCode,
							newTdmemberId,
							newTdbranchApplyDate); 
					$('#searchResult').append(newTr);
				});					
		        
		    });
		
		    request.fail(function (jQXHR, textStatus, err) {
		        console.log(err);
		    });
		});
					
			
			
		</script>
	</th:block>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</html>